<VirtualHost *:80>
    # WARNING: as a result of leaning on certbot updates to the template in chef
    # are not reflected in the SSL clone of it!
    # Needs updating in both places manually unfortunately.

    ServerAdmin  sitter@kde.org
    ServerName   <%= @server_name %>
    DocumentRoot <%= @document_root %>

    ErrorLog ${APACHE_LOG_DIR}/<%= @server_name %>-error.log
    CustomLog ${APACHE_LOG_DIR}/<%= @server_name %>.log combined

    # This is a full forward proxy, forwarding all requests.
    # BUT we send them all to squid and let squid sort out unwanted clients.
    # So ultimately this isn't a public forwarding proxy as everything goes
    # through squid and squid throws out rubbish requests.
    AllowEncodedSlashes NoDecode
    ProxyRequests On
    ProxyPreserveHost On
    ProxyPass /.well-known/acme-challenge/ !
    ProxyRemote * http://localhost:8000

    # This is the ACL mechanism, disable it, we have ACLs in squid.
    <Proxy *>
      Require all granted
    </Proxy>
</VirtualHost>
